# Урок 3. Состояния игры и готовность игроков

## Цель
- Научиться синхронизировать состояние между игроками.
- Реализовать простую механику `ready`.
- Ввести первое сетевое событие уровня игры.

## Требования
- Python 3.7+
- spritePro доступен в проекте

## Теория (кратко)
- События вроде `ready`, `start`, `pause` лучше синхронизировать отдельно от состояния.
- Хост может решать, когда начинается игра, и рассылать `start`.
- Клиенты должны поддерживать локальное состояние и обновлять его по сети.

## EventBus и прямые сообщения
- EventBus — для игровых событий (shoot, ready, start), удобно иметь подписчиков.
- Прямые `ctx.send()`/`send_every()` — для частых пакетов (позиции), меньше оверхеда.
- EventBus не заменяет сетевой слой, это просто удобная надстройка.
- В `example_ready_state_events.py` та же механика реализована через EventBus: отправка через `s.events.send("ready", route="all", net=ctx, id=..., value=...)`, приём через `ctx.poll()` с пробросом в `s.events.send(ev, **data)`, обработка через `s.events.connect("ready", ...)` и `s.events.connect("start", ...)`.

## Практика
1. Запустите `example_ready_state.py` и при желании `example_ready_state_events.py`.
1. Нажимайте `Space` для переключения готовности.
1. Убедитесь, что старт происходит после готовности обоих игроков.

## Вопросы для самопроверки
- Почему `start` — это событие, а не состояние?
- Что произойдет, если оба игрока нажмут `ready` одновременно?
- Где лучше хранить флаг `game_started`?

## Задания
- В `practice_ready_state.py` реализуйте логику старта от хоста.
- Обновляйте текст на экране при получении `start`.
- (Вариант) Реализуйте отправку ready/start через `s.events.send(..., route="all", net=ctx)` и обработку через `s.events.connect("ready", ...)` / `s.events.connect("start", ...)`; в цикле пробрасывайте входящие сообщения: `for msg in ctx.poll(): s.events.send(msg["event"], **msg.get("data", {}))`.

## Решение
- См. `solution_ready_state.py`.

## Что еще изучить
- Интерполяция и сглаживание движения.
- Авторитетный сервер и базовая валидация.
